{{define "_head"}}
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />

<script src="/js/domload.js"></script>

<!-- BOOTSTRAP STYLES -->
<link rel="stylesheet" href="/css/sketchy-bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.0/font/bootstrap-icons.css" />
<script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"></script>

<!-- HTMX / HYPERSCRIPT -->
<script src="https://unpkg.com/htmx.org@1.8.0/dist/htmx.min.js"></script>
<script src="https://unpkg.com/htmx.org@1.8.0/dist/ext/json-enc.js"></script>
<script src="https://unpkg.com/htmx.org@1.8.0/dist/ext/client-side-templates.js"></script>
<script src="https://unpkg.com/hyperscript.org@0.9.6/dist/_hyperscript.js"></script>
<script src="https://unpkg.com/nunjucks@3.2.3/browser/nunjucks.js"></script>

<!-- TABULATOR -->
<link rel="stylesheet" href="https://unpkg.com/tabulator-tables@5.3.4/dist/css/tabulator.min.css" />
<script src="https://unpkg.com/tabulator-tables@5.3.4/dist/js/tabulator.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/luxon@3.0.4/build/global/luxon.min.js"></script>

<!-- TOASTER BOX -->
<script defer src="/js/toaster-box.js"></script>
<link rel="stylesheet" href="/css/toaster-box.css" />

<!-- MISC -->
<script defer src="/js/utils.js"></script>
<link rel="stylesheet" href="/css/misc.css" />

<script type="module">
  import { deploymentFn as deploymentFnAnrFly } from "/deployments/anr-fly.js";
  import { deploymentFn as deploymentFnAnrLocal } from "/deployments/anr-local.js";
  import { GoGoPool, Blockchain } from "/js/gogopool.js";

  async function initGGPData() {
    // There is a nicer way to do this in Chrome, but hacking to support all browsers
    let deployment;
    switch (localStorage.getItem("deployment")) {
      case "anr-fly":
        deployment = await deploymentFnAnrFly();
        break;
      case "anr-local":
        deployment = await deploymentFnAnrLocal();
        break;
      default:
        console.log("ERROR no deployment selected");
    }

    window.GGP = new GoGoPool(deployment);
    window.BC = new Blockchain(deployment);

    await Promise.all([
      window.BC.fetchData(),
      window.GGP.fetchContracts(),
      window.GGP.fetchDashboardData(),
      // window.GGP.fetchMinipools({ status: [1, 2, 3] }),
      window.GGP.fetchMinipools(),
    ]);
    console.log("GGP Loaded", window.GGP);
    document.dispatchEvent(new Event("ggp:loaded"));
  }
  await initGGPData();
</script>

{{end}}
